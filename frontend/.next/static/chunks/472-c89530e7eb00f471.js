"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{5556:function(t,e,a){a.d(e,{Z:function(){return m}});var n=a(5893),r=a(7294),o=a(1664),s=a.n(o),l=a(6699),i=a(7414),c=a(9346),u=t=>{let{user:e}=(0,i.a)(),[a,n]=(0,r.useState)(!1),[o,s]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(e&&t&&e.id!==t)try{let e=await (0,c.rl)(t);n(e.isFollowing)}catch(t){console.error("Failed to check following status:",t)}})()},[e,t]);let l=async()=>{if(!e){alert("Bạn cần đăng nhập để theo d\xf5i.");return}if(e.id===t){alert("Bạn kh\xf4ng thể theo d\xf5i ch\xednh m\xecnh.");return}s(!0);try{a?(await (0,c.F6)(t),n(!1)):(await (0,c.P_)(t),n(!0))}catch(t){console.error("Failed to follow/unfollow:",t),alert("Đ\xe3 xảy ra lỗi. Vui l\xf2ng thử lại sau.")}finally{s(!1)}};return{isFollowing:a,toggleFollow:l,loading:o}},d=t=>{let{authorId:e}=t,{isFollowing:a,toggleFollow:r,loading:o}=u(e),{user:s}=(0,i.a)();return s&&e&&s.id!==e?(0,n.jsx)("button",{onClick:r,className:"ml-2 text-blue-500",disabled:o,children:a?(0,n.jsx)(l.UDo,{}):(0,n.jsx)(l.cHf,{})}):null},m=t=>{let{author:e}=t;return(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(s(),{href:"/".concat(null==e?void 0:e.username),legacyBehavior:!0,children:(0,n.jsxs)("a",{className:"flex items-center",children:[(0,n.jsx)("img",{src:(null==e?void 0:e.avatar_url)||"/default-avatar.png",alt:"".concat((null==e?void 0:e.name)||"Author"," Avatar"),className:"w-8 h-8 rounded-full mr-2"}),(0,n.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:(null==e?void 0:e.name)||"Unknown Author"})]})}),(0,n.jsx)(d,{authorId:e.id})]})}},8997:function(t,e,a){a.d(e,{Z:function(){return _}});var n=a(5893),r=a(7294),o=a(2914),s=t=>{let{onAddComment:e,parentId:a=null}=t,[s,l]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),u=async t=>{t.preventDefault(),""!==s.trim()&&(c(!0),await e(s,a),l(""),c(!1))};return(0,n.jsxs)("form",{onSubmit:u,className:"relative",children:[(0,n.jsx)("textarea",{className:"w-full border border-gray-300 rounded-md p-4 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none transition-all duration-200",placeholder:a?"Viết c\xe2u trả lời...":"Viết b\xecnh luận...",value:s,onChange:t=>l(t.target.value),rows:3,required:!0,"aria-label":a?"Reply to comment":"Add a comment"}),(0,n.jsx)("button",{type:"submit",className:"absolute right-4 bottom-4 bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 transition-colors ".concat(i?"bg-gray-400 cursor-not-allowed":""),disabled:i,"aria-label":"Submit comment",children:(0,n.jsx)(o.Y2X,{})})]})},l=a(1664),i=a.n(l),c=t=>{let{username:e,className:a}=t;return(0,n.jsx)(i(),{href:"/@".concat(e),children:(0,n.jsxs)("a",{className:"font-semibold ".concat(a),children:["@",e]})})},u=t=>{let{content:e}=t;return(0,n.jsx)("p",{className:"text-sm text-gray-700",children:(t=>{let e;let a=/@(\w+)/g,r=[],o=0;for(;null!==(e=a.exec(t));)r.push(t.substring(o,e.index)),r.push((0,n.jsx)(c,{username:e[1],className:"text-blue-500 hover:underline cursor-pointer"},e.index)),o=a.lastIndex;return r.push(t.substring(o)),r})(e)})},d=t=>{let{handleClap:e,clapsCount:a,hasClapped:r,handleToggleReply:s,repliesCount:l,showReplyForm:i,handleToggleReplies:c,showReplies:u}=t;return(0,n.jsxs)("div",{className:"flex items-center space-x-6 mt-2",children:[(0,n.jsxs)("button",{onClick:e,className:"flex items-center text-sm font-medium focus:outline-none transition-colors ".concat(r?"text-red-500":"text-gray-600 hover:text-red-500"),"aria-label":"Clap for this comment",children:[r?(0,n.jsx)(o.spm,{className:"mr-1"}):(0,n.jsx)(o.nM7,{className:"mr-1"}),a]}),(0,n.jsxs)("button",{onClick:s,className:"flex items-center text-sm text-gray-600 hover:text-blue-500 focus:outline-none transition-colors","aria-label":"Reply to this comment",children:[(0,n.jsx)(o.Bjt,{className:"mr-1"})," Trả lời"]}),l>0&&(0,n.jsxs)("button",{onClick:c,className:"flex items-center text-sm text-gray-600 hover:text-blue-500 focus:outline-none transition-colors","aria-label":u?"Ẩn phản hồi":"Hiển thị phản hồi",children:[u?(0,n.jsx)(o.s$2,{className:"mr-1"}):(0,n.jsx)(o.RiI,{className:"mr-1"}),u?"Ẩn phản hồi":"Hiển thị phản hồi (".concat(l,")")]})]})},m=a(5556),h=a(3246),p=a(8070),x=a(760),f=a(7414),g=a(1087);let y=(t,e)=>e?"...":t;var b=t=>{let{reply:e,commentId:a,mutate:r}=t,{user:o}=(0,f.a)(),{clapsCount:s,loading:l,hasClapped:i,mutate:u}=(0,p.B)("reply",e.id),d=async()=>{if(!o){alert("Bạn cần đăng nhập để clap.");return}try{await (0,x.VI)(e.id),u()}catch(t){console.error("Failed to clap:",t),alert(t.message||"Đ\xe3 xảy ra lỗi khi clap.")}};return(0,n.jsxs)("li",{className:"p-4 rounded bg-white border border-gray-200 transition hover:shadow-lg",children:[(0,n.jsx)(m.Z,{author:e.user}),(0,n.jsx)("p",{className:"text-gray-700 mt-2",children:(t=>{let e;let a=/@(\w+)/g,r=[],o=0;for(;null!==(e=a.exec(t));)r.push(t.substring(o,e.index)),r.push((0,n.jsx)(c,{username:e[1]},e.index)),o=a.lastIndex;return r.push(t.substring(o)),r})(e.content)}),(0,n.jsx)(g.Z,{timestamp:e.created_at}),(0,n.jsx)("div",{className:"flex items-center mt-2 space-x-4",children:(0,n.jsxs)("button",{onClick:d,className:"flex items-center text-sm font-medium ".concat(i?"text-red-500":"text-gray-600 hover:text-red-500"," transition-colors"),disabled:l,"aria-label":"Clap for this reply",children:[(0,n.jsx)(h.M_L,{className:"mr-1"})," ",y(s,l)]})})]})},j=t=>{let{replies:e,commentId:a,mutate:r}=t;return Array.isArray(e)?0===e.length?(0,n.jsx)("p",{className:"text-gray-600",children:"Chưa c\xf3 trả lời n\xe0o. H\xe3y l\xe0 người đầu ti\xean!"}):(0,n.jsx)("ul",{className:"space-y-4 mt-4 ml-8",children:e.map(t=>(0,n.jsx)(b,{reply:t,commentId:a,mutate:r},t.id))}):(console.error("Replies data is not an array:",e),(0,n.jsx)("div",{className:"text-red-500",children:"Dữ liệu trả lời kh\xf4ng hợp lệ."}))},w=a(8153),v=a(5480),k=a(3114),N=t=>{let{comment:e,postId:a,mutate:o}=t,[l,i]=(0,r.useState)(!1),{clapsCount:c,loading:h,hasClapped:y,mutate:b}=(0,p.B)("comment",e.id),{user:N}=(0,f.a)(),C=e.children?e.children.length:0,Z=async()=>{if(!N){alert("Bạn cần đăng nhập để clap.");return}try{await (0,x.x5)(e.id),b()}catch(t){console.error("Failed to clap:",t),alert("Đ\xe3 xảy ra lỗi khi clap. Vui l\xf2ng thử lại sau.")}},_=async(t,e)=>{if(!N){alert("Bạn cần đăng nhập để trả lời.");return}if(!t.trim()){alert("Nội dung trả lời kh\xf4ng được để trống.");return}try{await (0,w.Bn)(e,t,N.id),o(),i(!1)}catch(t){console.error("Failed to add reply:",t),alert("Gửi trả lời thất bại. Vui l\xf2ng thử lại.")}};return(0,n.jsxs)(v.E.li,{className:"p-4 rounded bg-gray-50 shadow-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,n.jsx)(m.Z,{author:e.user}),(0,n.jsx)(u,{content:e.content}),(0,n.jsx)(g.Z,{timestamp:e.created_at}),(0,n.jsx)(d,{handleClap:Z,clapsCount:c,hasClapped:y,handleToggleReply:()=>{i(t=>!t)},repliesCount:C,showReplyForm:l}),(0,n.jsx)(k.M,{children:l&&(0,n.jsx)(v.E.div,{className:"mt-4 ml-8",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:(0,n.jsx)(s,{onAddComment:t=>_(t,e.id),parentId:e.id})})}),e.replies&&e.replies.length>0&&(0,n.jsx)(j,{replies:e.replies,commentId:e.id,mutate:o})]})},C=t=>{let{comments:e,postId:a,mutate:r}=t;return Array.isArray(e)?0===e.length?(0,n.jsx)("p",{className:"text-gray-600",children:"Chưa c\xf3 b\xecnh luận n\xe0o. H\xe3y l\xe0 người đầu ti\xean!"}):(0,n.jsx)("ul",{className:"space-y-4",children:(0,n.jsx)(k.M,{children:e.map(t=>(0,n.jsx)(N,{comment:t,postId:a,mutate:r},t.id))})}):(console.error("Comments data is not an array:",e),(0,n.jsx)("div",{className:"text-red-500",children:"Dữ liệu b\xecnh luận kh\xf4ng hợp lệ."}))},Z=a(7636),_=t=>{let{isOpen:e,onClose:a,postId:l,user:i}=t,{comments:c,isLoading:u,isError:d,mutate:m}=(0,Z.M)(l,e,1,10),h=t=>{let e=0;for(let a of t)e+=1,a.children&&a.children.length>0&&(e+=h(a.children));return e},p=(0,r.useMemo)(()=>c&&c.length>0?h(c):0,[c]),x=async t=>{if(!i){alert("Bạn cần đăng nhập để b\xecnh luận.");return}if(!t.trim()){alert("Nội dung b\xecnh luận kh\xf4ng được để trống.");return}try{await (0,w.Ir)(l,t,i.id),m()}catch(t){console.error("Failed to add comment:",t),alert("Gửi b\xecnh luận thất bại. Vui l\xf2ng thử lại.")}};return(0,r.useEffect)(()=>{let t=t=>{"Escape"===t.key&&a()};return e&&document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,a]),(0,n.jsx)(k.M,{children:e&&(0,n.jsxs)(v.E.div,{className:"fixed inset-0 flex justify-end z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,n.jsx)(v.E.div,{className:"fixed inset-0 bg-black opacity-30",onClick:a,"aria-label":"Close Comments",initial:{opacity:0},animate:{opacity:.3},exit:{opacity:0},transition:{duration:.3}}),(0,n.jsxs)(v.E.div,{className:"relative w-full max-w-md bg-white shadow-lg overflow-y-auto h-full",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.3},children:[(0,n.jsx)("button",{className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800 focus:outline-none",onClick:a,"aria-label":"Close Comments",children:(0,n.jsx)(o.aHS,{size:20})}),(0,n.jsx)("div",{className:"p-4 border-b",children:(0,n.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:["B\xecnh Luận (",p,")"]})}),(0,n.jsx)("div",{className:"p-4 border-b",children:i?(0,n.jsx)(s,{onAddComment:x}):(0,n.jsx)("p",{className:"text-gray-600",children:"Bạn cần đăng nhập để b\xecnh luận."})}),(0,n.jsxs)("div",{className:"p-4",children:[d&&(0,n.jsx)("div",{className:"text-red-500",children:"Kh\xf4ng thể tải b\xecnh luận."}),u&&!d&&(0,n.jsxs)("div",{className:"flex justify-center items-center",children:[(0,n.jsx)(FaSpinner,{className:"animate-spin text-gray-500 mr-2"}),(0,n.jsx)("span",{className:"text-gray-500",children:"Đang tải b\xecnh luận..."})]}),c&&(0,n.jsx)(C,{comments:c,postId:l,mutate:m})]})]})]})})}},2072:function(t,e,a){a.d(e,{Z:function(){return m}});var n=a(5893),r=a(7294),o=a(4716),s=a(6607);let l=async(t,e)=>(await o.Z.post("/api/posts/".concat(t,"/ratings"),{post_id:t,rating:e,score:e})).data,i=async t=>(await s.Z.get("/posts/".concat(t,"/ratings"))).data.average_rating;var c=a(7414);let u=t=>{let{user:e}=(0,c.a)(),[a,n]=(0,r.useState)(0),[o,s]=(0,r.useState)(0),[u,d]=(0,r.useState)(0);return(0,r.useEffect)(()=>{(async()=>{try{let e=await i(t);s(e)}catch(t){console.error("Failed to fetch average rating",t)}})()},[t]),{rating:a,averageRating:o,hover:u,setHover:d,handleSubmitRating:async a=>{if(!e){alert("Bạn cần đăng nhập để clap.");return}try{await l(t,a),n(a);let e=await i(t);s(e)}catch(t){console.error("Failed to submit rating",t)}}}};var d=a(2914),m=t=>{let{postId:e}=t,{averageRating:a,hover:r,setHover:o,handleSubmitRating:s}=u(e),l=t=>r>=t?(0,n.jsx)(d.QJe,{}):r||!(a>=t-.5)?(0,n.jsx)(d.jJN,{}):a>=t?(0,n.jsx)(d.QJe,{}):(0,n.jsx)(d.TtB,{});return(0,n.jsxs)("div",{className:"flex items-center",children:[[1,2,3,4,5].map(t=>(0,n.jsx)("span",{onClick:()=>s(t),onMouseEnter:()=>o(t),onMouseLeave:()=>o(0),className:"cursor-pointer text-yellow-400 transition-transform duration-200 ".concat(r>=t?"scale-110":"scale-100"),children:l(t)},t)),a>0&&(0,n.jsxs)("span",{className:"ml-2 text-gray-700 text-sm",children:[a.toFixed(1)," / 5"]})]})}},1087:function(t,e,a){var n=a(5893);a(7294);let r=t=>{let e=Math.floor((new Date-new Date(t))/1e3),a=Math.floor(e/86400);return a>=1?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):(a=Math.floor(e/3600))>=1?"".concat(a," hour").concat(1===a?"":"s"," ago"):(a=Math.floor(e/60))>=1?"".concat(a," minute").concat(1===a?"":"s"," ago"):"just now"};e.Z=t=>{let{timestamp:e}=t;return(0,n.jsx)("p",{className:"text-sm font-medium text-gray-600 mt-1 inline-flex items-center space-x-1",children:(0,n.jsx)("span",{children:r(e)})})}},7559:function(t,e,a){var n=a(7294),r=a(7187),o=a(7414),s=a(9820);e.Z=t=>{let{user:e}=(0,o.a)(),[a,l]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(!e){l(!1);return}try{let e=await (0,r.UI)(t);l(e.is_bookmarked)}catch(t){console.error("Failed to check bookmark status:",t)}})()},[t,e]);let u=(0,n.useCallback)(async()=>{if(!e){alert("Bạn cần đăng nhập để lưu b\xe0i viết.");return}c(!0);try{if(a){let e=await (0,r.SI)(t);"Bookmark removed"===e.message?l(!1):alert("Kh\xf4ng thể loại bỏ bookmark. Vui l\xf2ng thử lại.")}else{let e=await (0,r.up)(t);"Bookmark created"===e.message||"Bookmark reactivated"===e.message?l(!0):"Bookmark already exists"===e.message?l(!0):alert("Kh\xf4ng thể lưu bookmark. Vui l\xf2ng thử lại.")}(0,s.JG)("/api/bookmarks")}catch(t){console.error("Failed to toggle bookmark:",t),alert("Đ\xe3 xảy ra lỗi khi xử l\xfd bookmark. Vui l\xf2ng thử lại.")}finally{c(!1)}},[a,t,e]);return{isBookmarked:a,toggleBookmark:u,loading:i}}},8070:function(t,e,a){a.d(e,{B:function(){return o}});var n=a(9820),r=a(760);let o=(t,e)=>{let a="/claps?type=".concat(t,"&id=").concat(e),{data:o,error:s,mutate:l}=(0,n.ZP)(a,()=>(0,r.JZ)(t,e));o&&!("number"==typeof o||"object"==typeof o&&"number"==typeof o.clap_count)&&console.error("Unexpected claps count format:",o);let i=0;return"number"==typeof o?i=o:"object"==typeof o&&"number"==typeof o.clap_count&&(i=o.clap_count),{clapsCount:i,loading:!s&&!o,isError:s,hasClapped:i>0,mutate:l}}},7636:function(t,e,a){a.d(e,{M:function(){return o}});var n=a(9820),r=a(8153);let o=function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,s=e?"/posts/".concat(t,"/comments?page=").concat(a,"&limit=").concat(o):null,{data:l,error:i,mutate:c}=(0,n.ZP)(s,()=>(0,r.rN)(t,a,o));return l&&("object"!=typeof l||!Array.isArray(l.data)||"number"!=typeof l.totalCount)&&console.error("Unexpected comments format:",l),{comments:l?l.data:[],totalCount:l?l.totalCount:0,totalCommentReply:l?l.totalCommentReply:0,isLoading:!i&&!l,isError:i,mutate:c}}},760:function(t,e,a){a.d(e,{JZ:function(){return i},VI:function(){return l},nl:function(){return o},x5:function(){return s}});var n=a(4716),r=a(6607);let o=async t=>(await n.Z.post("/api/post/".concat(t,"/clap"))).data,s=async t=>(await n.Z.post("/api/comment/".concat(t,"/clap"))).data,l=async t=>(await n.Z.post("/api/reply/".concat(t,"/clap"))).data,i=async(t,e)=>(await r.Z.get("/claps",{params:{type:t,id:e}})).data.clap_count},7187:function(t,e,a){a.d(e,{Lm:function(){return s},SI:function(){return o},UI:function(){return l},up:function(){return r}});var n=a(4716);let r=async t=>(await n.Z.post("/api/bookmarks",{post_id:t})).data,o=async t=>(await n.Z.post("/api/bookmarks/unbookmark",{post_id:t})).data,s=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=(await n.Z.get("/api/bookmarks?page=".concat(t,"&limit=").concat(e))).data;if(!a||!Array.isArray(a.data)||"number"!=typeof a.total_count)throw Error("Invalid response format for getReadingList");return{username:"pdhoang91",posts:a.data,totalCount:a.total_count}},l=async t=>(await n.Z.get("/api/bookmarks/isBookmarked/".concat(t))).data},8153:function(t,e,a){a.d(e,{Bn:function(){return l},Ir:function(){return s},rN:function(){return o}});var n=a(4716),r=a(6607);let o=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,{data:n,total_count:o,total_comment_reply:s}=(await r.Z.get("/posts/".concat(t,"/comments?page=").concat(e,"&limit=").concat(a))).data;return{data:n,totalCommentReply:s,totalCount:o}},s=async(t,e)=>(await n.Z.post("/api/posts/".concat(t,"/comments"),{post_id:t,content:e})).data,l=async(t,e)=>(await n.Z.post("/api/comments/".concat(t,"/replies"),{comment_id:t,content:e})).data},9346:function(t,e,a){a.d(e,{F6:function(){return l},P_:function(){return s},QL:function(){return i},kS:function(){return c},rl:function(){return o}});var n=a(4716),r=a(6607);let o=async t=>(await n.Z.get("/api/follow/status/".concat(t))).data,s=async t=>(await n.Z.post("/api/follow",{following_id:t})).data,l=async t=>(await n.Z.delete("/api/unfollow/".concat(t))).data,i=async()=>{try{let t=await r.Z.get("/follow/writers");return console.log("response1",t),t.data.data}catch(t){throw console.error("Error fetching writers:",t),t}},c=async()=>{try{let t=await r.Z.get("/follow/topics");return console.log("response2",t),t.data.data}catch(t){throw console.error("Error fetching topics:",t),t}}}}]);