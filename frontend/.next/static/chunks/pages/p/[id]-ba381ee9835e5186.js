(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[795],{318:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/[id]",function(){return n(2148)}])},2148:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return w}});var s=n(5893),a=n(1163),r=n(7294),o=n(9820),l=n(3784);let i=t=>{var e;let{data:n,error:s,mutate:a}=(0,o.ZP)(t?"/p/".concat(t):null,()=>(0,l.a2)(t));return{post:null!==(e=null==n?void 0:n.post)&&void 0!==e?e:null,isLoading:!s&&!n,isError:s,mutate:a}};var c=n(7414),u=n(1409),d=n(2914),p=n(8997),m=n(2072),h=n(5556),f=n(8070),x=n(760),g=n(7559),v=n(7636),j=t=>{var e;let{post:n}=t;if(!n)return(0,s.jsx)("div",{children:"Đang tải b\xe0i viết..."});let{clapsCount:a,loading:o,hasClapped:l,mutate:i}=(0,f.B)("post",n.id),{user:j}=(0,c.a)(),{isBookmarked:w,toggleBookmark:y,loading:N}=(0,g.Z)(n.id),[C,b]=r.useState(!1),{comments:_,totalCount:E,totalCommentReply:P,isLoading:k,isError:I,mutate:R}=(0,v.M)(n.id,!0,1,10),Z=async()=>{if(!j){alert("Bạn cần đăng nhập để clap.");return}try{await (0,x.nl)(n.id),i()}catch(t){console.error("Failed to clap:",t),alert("Đ\xe3 xảy ra lỗi khi clap. Vui l\xf2ng thử lại sau.")}},M="http://localhost:3000/post/".concat(n.title_name);return(0,s.jsxs)("div",{className:"p-4 mb-4 flex flex-col",children:[(null===(e=n.categories)||void 0===e?void 0:e.length)>0&&(0,s.jsx)("img",{src:"string"==typeof n.categories[0]?n.categories[0]:n.categories[0].url,alt:n.title,className:"h-40 w-full center-parent object-cover rounded mb-4"}),(0,s.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gray-800",children:n.title}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-4",children:[n.user&&(0,s.jsx)(h.Z,{author:n.user}),(0,s.jsx)("span",{className:"ml-2",children:new Date(n.created_at).toLocaleDateString()})]}),(0,s.jsxs)("div",{className:"flex items-center text-gray-600 mb-4 space-x-4",children:[(0,s.jsxs)("button",{onClick:Z,className:"flex items-center ".concat(l?"text-red-500":"text-gray-600 hover:text-red-500"),children:[(0,s.jsx)(u.sOS,{className:"mr-1"})," ",a]}),(0,s.jsxs)("button",{onClick:()=>{b(t=>!t)},className:"flex items-center",children:[(0,s.jsx)(u.RcG,{className:"mr-1"})," ",P]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.dSq,{className:"mr-1"})," ",n.views]}),(0,s.jsxs)("button",{onClick:y,className:"flex items-center",disabled:N,children:[w?(0,s.jsx)(d.VF9,{className:"mr-1 text-yellow-500"}):(0,s.jsx)(d.mCg,{className:"mr-1"}),N&&(0,s.jsx)("span",{className:"ml-1 text-sm",children:"..."})]}),(0,s.jsx)("button",{onClick:()=>{navigator.share?navigator.share({title:n.title,url:M}):alert("Tr\xecnh duyệt của bạn kh\xf4ng hỗ trợ chia sẻ.")},className:"flex items-center",children:(0,s.jsx)(d.PPi,{className:"mr-1"})})]}),(0,s.jsx)("div",{className:"prose max-w-none mb-8",children:(0,s.jsx)("div",{className:"post-content",dangerouslySetInnerHTML:{__html:n.content}})}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(m.Z,{postId:n.id,userId:j?j.id:null})}),(0,s.jsx)(p.Z,{isOpen:C,onClose:()=>{b(!1)},postId:n.id,user:j,comments:_})]})},w=()=>{let{id:t}=(0,a.useRouter)().query,{post:e,isLoading:n,isError:r,mutate:o}=i(t);return n?(0,s.jsx)("div",{children:"Loading..."}):r?(0,s.jsx)("div",{children:"Failed to load post."}):(0,s.jsxs)("div",{className:"flex min-h-screen",children:[(0,s.jsx)("div",{className:"hidden lg:block lg:w-2/12"}),(0,s.jsx)("main",{className:"flex-1 p-6 overflow-auto",children:(0,s.jsx)(j,{post:e})}),(0,s.jsx)("div",{className:"hidden lg:block lg:w-2/12"})]})}},3784:function(t,e,n){"use strict";n.d(e,{CP:function(){return l},Ix:function(){return p},Jq:function(){return r},KY:function(){return u},Td:function(){return d},a2:function(){return c},qb:function(){return o},u_:function(){return i}});var s=n(4716),a=n(6607);let r=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await a.Z.get("/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getPosts");return{posts:n.data,totalCount:n.total_count}},o=async t=>(await s.Z.post("/api/posts",t)).data,l=async(t,e)=>(await s.Z.put("/api/posts/".concat(t),e)).data,i=async t=>(await a.Z.get("/posts/".concat(t))).data.data,c=async t=>(await a.Z.get("/p/".concat(t))).data.data,u=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await s.Z.get("/api/following/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getFollowingPosts");return{posts:n.data,totalCount:n.total_count}},d=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=(await a.Z.get("/categories/".concat(encodeURIComponent(t),"/posts?page=").concat(e,"&limit=").concat(n))).data;if(!s||!Array.isArray(s.data)||"number"!=typeof s.total_count)throw Error("Invalid response format for getPostsByCategory");return{posts:s.data,totalCount:s.total_count}},p=async t=>{let e=new FormData;e.append("image",t);let n=await a.Z.post("/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return console.log("response.data.url",n.data.url),n.data.url}},3114:function(t,e,n){"use strict";n.d(e,{M:function(){return g}});var s=n(5893),a=n(7294),r=n(240),o=n(6681),l=n(6014);class i extends a.Component{getSnapshotBeforeUpdate(t){let e=this.props.childRef.current;if(e&&t.isPresent&&!this.props.isPresent){let t=this.props.sizeRef.current;t.height=e.offsetHeight||0,t.width=e.offsetWidth||0,t.top=e.offsetTop,t.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function c({children:t,isPresent:e}){let n=(0,a.useId)(),r=(0,a.useRef)(null),o=(0,a.useRef)({width:0,height:0,top:0,left:0}),{nonce:c}=(0,a.useContext)(l._);return(0,a.useInsertionEffect)(()=>{let{width:t,height:s,top:a,left:l}=o.current;if(e||!r.current||!t||!s)return;r.current.dataset.motionPopId=n;let i=document.createElement("style");return c&&(i.nonce=c),document.head.appendChild(i),i.sheet&&i.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${t}px !important;
            height: ${s}px !important;
            top: ${a}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(i)}},[e]),(0,s.jsx)(i,{isPresent:e,childRef:r,sizeRef:o,children:a.cloneElement(t,{ref:r})})}let u=({children:t,initial:e,isPresent:n,onExitComplete:l,custom:i,presenceAffectsLayout:u,mode:p})=>{let m=(0,o.h)(d),h=(0,a.useId)(),f=(0,a.useCallback)(t=>{for(let e of(m.set(t,!0),m.values()))if(!e)return;l&&l()},[m,l]),x=(0,a.useMemo)(()=>({id:h,initial:e,isPresent:n,custom:i,onExitComplete:f,register:t=>(m.set(t,!1),()=>m.delete(t))}),u?[Math.random(),f]:[n,f]);return(0,a.useMemo)(()=>{m.forEach((t,e)=>m.set(e,!1))},[n]),a.useEffect(()=>{n||m.size||!l||l()},[n]),"popLayout"===p&&(t=(0,s.jsx)(c,{isPresent:n,children:t})),(0,s.jsx)(r.O.Provider,{value:x,children:t})};function d(){return new Map}var p=n(5364),m=n(5487);let h=t=>t.key||"";function f(t){let e=[];return a.Children.forEach(t,t=>{(0,a.isValidElement)(t)&&e.push(t)}),e}var x=n(8868);let g=({children:t,exitBeforeEnter:e,custom:n,initial:r=!0,onExitComplete:l,presenceAffectsLayout:i=!0,mode:c="sync"})=>{(0,m.k)(!e,"Replace exitBeforeEnter with mode='wait'");let d=(0,a.useMemo)(()=>f(t),[t]),g=d.map(h),v=(0,a.useRef)(!0),j=(0,a.useRef)(d),w=(0,o.h)(()=>new Map),[y,N]=(0,a.useState)(d),[C,b]=(0,a.useState)(d);(0,x.L)(()=>{v.current=!1,j.current=d;for(let t=0;t<C.length;t++){let e=h(C[t]);g.includes(e)?w.delete(e):!0!==w.get(e)&&w.set(e,!1)}},[C,g.length,g.join("-")]);let _=[];if(d!==y){let t=[...d];for(let e=0;e<C.length;e++){let n=C[e],s=h(n);g.includes(s)||(t.splice(e,0,n),_.push(n))}"wait"===c&&_.length&&(t=_),b(f(t)),N(d);return}let{forceRender:E}=(0,a.useContext)(p.p);return(0,s.jsx)(s.Fragment,{children:C.map(t=>{let e=h(t),a=d===C||g.includes(e);return(0,s.jsx)(u,{isPresent:a,initial:(!v.current||!!r)&&void 0,custom:a?void 0:n,presenceAffectsLayout:i,mode:c,onExitComplete:a?void 0:()=>{if(!w.has(e))return;w.set(e,!0);let t=!0;w.forEach(e=>{e||(t=!1)}),t&&(null==E||E(),b(j.current),l&&l())},children:t},e)})})}}},function(t){t.O(0,[445,237,778,617,197,889,472,888,774,179],function(){return t(t.s=318)}),_N_E=t.O()}]);