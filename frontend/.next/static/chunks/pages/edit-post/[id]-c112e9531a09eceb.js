(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[243],{7407:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/edit-post/[id]",function(){return n(3702)}])},2711:function(t,e,n){"use strict";n.d(e,{Z:function(){return h}});var a=n(5893),o=n(7294),i=n(1284),r=n(4929),c=n(6761),l=n(9404),s=n(3621),u=n(8510);let d=n(5865).NB.create({name:"imageUpload",addCommands:()=>({setImage:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return a=>{let{commands:o}=a;return o.insertContent({type:"image",attrs:{src:t,alt:e,title:n}})}}})});var p=n(6607);let m=async t=>{let e=new FormData;e.append("image",t);let n=await p.Z.post("/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}});console.log("response.data.url",n.data.url);let a=n.data;return a.url.startsWith("http")?a.url:"http://".concat(a.url)};var f=n(2914);let g=t=>{let{icon:e,onClick:n,isActive:o,tooltip:i,disabled:r}=t;return(0,a.jsx)("button",{onClick:n,disabled:r,className:"p-2 rounded hover:bg-blue-100 focus:outline-none ".concat(o?"bg-blue-500 text-white":"text-gray-700"," ").concat(r?"opacity-50 cursor-not-allowed":""),"aria-label":i,title:i,children:(0,a.jsx)(e,{})})};var h=t=>{let{title:e,setTitle:n,content:p,setContent:h,imageTitle:v,setImageTitle:y}=t,[x,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)(!0),[N,C]=(0,o.useState)(!1),k=(0,i.jE)({extensions:[r.Z,s.Z,u.Z,l.ZP.configure({openOnClick:!1}),c.ZP,d],content:p,onUpdate:t=>{let{editor:e}=t,n=e.getHTML();h(n),j(""===n.trim())}}),A=()=>{let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let e=t.files[0];if(e){b(!0);try{let t=await m(e);k.chain().focus().setImage({src:t}).run()}catch(t){console.error("Error uploading image",t)}finally{b(!1)}}}},E=(0,o.useMemo)(()=>k?[{icon:f.PKR,action:()=>k.chain().focus().toggleBold().run(),isActive:()=>k.isActive("bold"),tooltip:"Đậm"},{icon:f.Mef,action:()=>k.chain().focus().toggleItalic().run(),isActive:()=>k.isActive("italic"),tooltip:"Nghi\xeang"},{icon:f.LRB,action:()=>k.chain().focus().toggleUnderline().run(),isActive:()=>k.isActive("underline"),tooltip:"Gạch ch\xe2n"},{icon:f.zal,action:()=>k.chain().focus().toggleStrike().run(),isActive:()=>k.isActive("strike"),tooltip:"Gạch ngang"},{icon:f.tLl,action:()=>k.chain().focus().toggleBlockquote().run(),isActive:()=>k.isActive("blockquote"),tooltip:"Tr\xedch dẫn"},{icon:f.gjK,action:()=>{let t=prompt("Nhập URL");t&&k.chain().focus().extendMarkRange("link").setLink({href:t}).run()},isActive:()=>k.isActive("link"),tooltip:"Ch\xe8n li\xean kết"},{icon:f.H3h,action:A,isActive:!1,tooltip:"Ch\xe8n h\xecnh ảnh"}]:[],[k]);return(0,a.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!e.trim()||w){alert("Vui l\xf2ng nhập đầy đủ ti\xeau đề v\xe0 nội dung b\xe0i viết.");return}console.log("Post Data:",{title:e,imageTitle:v,content:p})},className:"max-w-3xl mx-auto p-6 relative",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:e,onChange:t=>n(t.target.value),required:!0,className:"w-full pr-10 p-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500",placeholder:"ti\xeau đề b\xe0i viết..."}),(0,a.jsx)("button",{type:"button",onClick:()=>{let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let e=t.files[0];if(e){C(!0);try{let t=await m(e);y(t)}catch(t){console.error("Error uploading image title",t)}finally{C(!1)}}}},className:"absolute right-0 top-0 mt-3 mr-3 text-gray-500 hover:text-blue-500","aria-label":"Upload Image Title",title:"Tải l\xean ảnh ti\xeau đề",children:N?(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}):v?(0,a.jsx)("img",{src:v,alt:"Image Title",className:"w-5 h-5 object-cover rounded-full"}):(0,a.jsx)(f.DUB,{})})]})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center space-x-2 p-2",children:E.map(t=>(0,a.jsx)(g,{icon:t.icon,onClick:t.action,isActive:!!t.isActive&&t.isActive(),tooltip:t.tooltip,disabled:!k},t.tooltip))})}),(0,a.jsxs)("div",{className:"mb-4 p-4 min-h-[300px] relative",children:[x&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-50",children:(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})}),k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.kg,{editor:k}),w&&(0,a.jsx)("p",{className:"absolute text-gray-500 italic top-4 left-4 pointer-events-none",children:"nội dung b\xe0i viết..."})]}):(0,a.jsx)("p",{className:"text-gray-400",children:"Loading editor..."})]})]})}},6771:function(t,e,n){"use strict";n.d(e,{w_:function(){return l}});var a=n(7294),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=a.createContext&&a.createContext(o),r=function(){return(r=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=function(t,e){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&0>e.indexOf(a)&&(n[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,a=Object.getOwnPropertySymbols(t);o<a.length;o++)0>e.indexOf(a[o])&&Object.prototype.propertyIsEnumerable.call(t,a[o])&&(n[a[o]]=t[a[o]]);return n};function l(t){return function(e){return a.createElement(s,r({attr:r({},t.attr)},e),function t(e){return e&&e.map(function(e,n){return a.createElement(e.tag,r({key:n},e.attr),t(e.child))})}(t.child))}}function s(t){var e=function(e){var n,o=t.attr,i=t.size,l=t.title,s=c(t,["attr","size","title"]),u=i||e.size||"1em";return e.className&&(n=e.className),t.className&&(n=(n?n+" ":"")+t.className),a.createElement("svg",r({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,o,s,{className:n,style:r(r({color:t.color||e.color},e.style),t.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&a.createElement("title",null,l),t.children)};return void 0!==i?a.createElement(i.Consumer,null,function(t){return e(t)}):e(o)}},3702:function(t,e,n){"use strict";n.r(e);var a=n(5893),o=n(1163),i=n(7294),r=n(7414),c=n(2711),l=n(3784);e.default=()=>{let t=(0,o.useRouter)(),{id:e}=t.query,{user:n}=(0,r.a)(),[s,u]=(0,i.useState)(null);(0,i.useEffect)(()=>{e&&(0,l.u_)(e).then(t=>{u(t)}).catch(t=>{console.error(t)})},[e]);let d=async(n,a,o,i)=>{try{await (0,l.CP)(e,{title:n,content:a,categories:o,tags:i}),t.push("/post/".concat(e))}catch(t){console.error("Failed to update post:",t)}};return s?(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Edit Post"}),(0,a.jsx)(c.Z,{title:s.title,setTitle:t=>u({...s,title:t}),content:s.content,setContent:t=>u({...s,content:t}),onSubmit:d})]}):(0,a.jsx)("div",{children:"Loading..."})}},3784:function(t,e,n){"use strict";n.d(e,{CP:function(){return c},Ix:function(){return p},Jq:function(){return i},KY:function(){return u},Td:function(){return d},a2:function(){return s},qb:function(){return r},u_:function(){return l}});var a=n(4716),o=n(6607);let i=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await o.Z.get("/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getPosts");return{posts:n.data,totalCount:n.total_count}},r=async t=>(await a.Z.post("/api/posts",t)).data,c=async(t,e)=>(await a.Z.put("/api/posts/".concat(t),e)).data,l=async t=>(await o.Z.get("/posts/".concat(t))).data.data,s=async t=>(await o.Z.get("/p/".concat(t))).data.data,u=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await a.Z.get("/api/following/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getFollowingPosts");return{posts:n.data,totalCount:n.total_count}},d=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(await o.Z.get("/categories/".concat(encodeURIComponent(t),"/posts?page=").concat(e,"&limit=").concat(n))).data;if(!a||!Array.isArray(a.data)||"number"!=typeof a.total_count)throw Error("Invalid response format for getPostsByCategory");return{posts:a.data,totalCount:a.total_count}},p=async t=>{let e=new FormData;e.append("image",t);let n=await o.Z.post("/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return console.log("response.data.url",n.data.url),n.data.url}}},function(t){t.O(0,[445,911,509,624,888,774,179],function(){return t(t.s=7407)}),_N_E=t.O()}]);