(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{1175:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/write",function(){return n(749)}])},2711:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var a=n(5893),i=n(7294),s=n(1284),r=n(4929),o=n(6761),l=n(9404),c=n(3621),u=n(8510);let d=n(5865).NB.create({name:"imageUpload",addCommands:()=>({setImage:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return a=>{let{commands:i}=a;return i.insertContent({type:"image",attrs:{src:e,alt:t,title:n}})}}})});var p=n(6607);let m=async e=>{let t=new FormData;t.append("image",e);let n=await p.Z.post("/images/upload",t,{headers:{"Content-Type":"multipart/form-data"}});console.log("response.data.url",n.data.url);let a=n.data;return a.url.startsWith("http")?a.url:"http://".concat(a.url)};var h=n(2914);let g=e=>{let{icon:t,onClick:n,isActive:i,tooltip:s,disabled:r}=e;return(0,a.jsx)("button",{onClick:n,disabled:r,className:"p-2 rounded hover:bg-blue-100 focus:outline-none ".concat(i?"bg-blue-500 text-white":"text-gray-700"," ").concat(r?"opacity-50 cursor-not-allowed":""),"aria-label":s,title:s,children:(0,a.jsx)(t,{})})};var f=e=>{let{title:t,setTitle:n,content:p,setContent:f,imageTitle:x,setImageTitle:b}=e,[v,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!0),[N,C]=(0,i.useState)(!1),k=(0,s.jE)({extensions:[r.Z,c.Z,u.Z,l.ZP.configure({openOnClick:!1}),o.ZP,d],content:p,onUpdate:e=>{let{editor:t}=e,n=t.getHTML();f(n),w(""===n.trim())}}),A=()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let t=e.files[0];if(t){y(!0);try{let e=await m(t);k.chain().focus().setImage({src:e}).run()}catch(e){console.error("Error uploading image",e)}finally{y(!1)}}}},E=(0,i.useMemo)(()=>k?[{icon:h.PKR,action:()=>k.chain().focus().toggleBold().run(),isActive:()=>k.isActive("bold"),tooltip:"Đậm"},{icon:h.Mef,action:()=>k.chain().focus().toggleItalic().run(),isActive:()=>k.isActive("italic"),tooltip:"Nghi\xeang"},{icon:h.LRB,action:()=>k.chain().focus().toggleUnderline().run(),isActive:()=>k.isActive("underline"),tooltip:"Gạch ch\xe2n"},{icon:h.zal,action:()=>k.chain().focus().toggleStrike().run(),isActive:()=>k.isActive("strike"),tooltip:"Gạch ngang"},{icon:h.tLl,action:()=>k.chain().focus().toggleBlockquote().run(),isActive:()=>k.isActive("blockquote"),tooltip:"Tr\xedch dẫn"},{icon:h.gjK,action:()=>{let e=prompt("Nhập URL");e&&k.chain().focus().extendMarkRange("link").setLink({href:e}).run()},isActive:()=>k.isActive("link"),tooltip:"Ch\xe8n li\xean kết"},{icon:h.H3h,action:A,isActive:!1,tooltip:"Ch\xe8n h\xecnh ảnh"}]:[],[k]);return(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!t.trim()||j){alert("Vui l\xf2ng nhập đầy đủ ti\xeau đề v\xe0 nội dung b\xe0i viết.");return}console.log("Post Data:",{title:t,imageTitle:x,content:p})},className:"max-w-3xl mx-auto p-6 relative",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value),required:!0,className:"w-full pr-10 p-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500",placeholder:"ti\xeau đề b\xe0i viết..."}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let t=e.files[0];if(t){C(!0);try{let e=await m(t);b(e)}catch(e){console.error("Error uploading image title",e)}finally{C(!1)}}}},className:"absolute right-0 top-0 mt-3 mr-3 text-gray-500 hover:text-blue-500","aria-label":"Upload Image Title",title:"Tải l\xean ảnh ti\xeau đề",children:N?(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}):x?(0,a.jsx)("img",{src:x,alt:"Image Title",className:"w-5 h-5 object-cover rounded-full"}):(0,a.jsx)(h.DUB,{})})]})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center space-x-2 p-2",children:E.map(e=>(0,a.jsx)(g,{icon:e.icon,onClick:e.action,isActive:!!e.isActive&&e.isActive(),tooltip:e.tooltip,disabled:!k},e.tooltip))})}),(0,a.jsxs)("div",{className:"mb-4 p-4 min-h-[300px] relative",children:[v&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-50",children:(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})}),k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.kg,{editor:k}),j&&(0,a.jsx)("p",{className:"absolute text-gray-500 italic top-4 left-4 pointer-events-none",children:"nội dung b\xe0i viết..."})]}):(0,a.jsx)("p",{className:"text-gray-400",children:"Loading editor..."})]})]})}},749:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(5893),i=n(7294),s=n(1163),r=n(7414),o=n(2914),l=n(3114),c=n(5480);let u=(e,t)=>{if(!e)return"";let n=e.replace(/<[^>]+>/g,"");return n.length>t?n.substring(0,t)+"...":n};var d=e=>{let{title:t,content:n,imageTitle:s,onPublish:r,onCancel:d}=e,[p,m]=(0,i.useState)(""),[h,g]=(0,i.useState)("");return(0,a.jsx)(l.M,{children:(0,a.jsx)(c.E.div,{className:"fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:(0,a.jsxs)(c.E.div,{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-3xl mx-auto p-6 relative",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:300,damping:25},children:[(0,a.jsx)("button",{className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800 focus:outline-none",onClick:d,"aria-label":"Đ\xf3ng Popup",children:(0,a.jsx)(o.aHS,{size:20})}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsxs)("div",{className:"w-full md:w-1/2 p-4 border-r mb-4 md:mb-0",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2 text-gray-800",children:"Xem Trước B\xe0i Viết"}),(0,a.jsxs)("div",{className:"border p-4 rounded bg-gray-100",children:[s&&(0,a.jsx)("img",{src:s,alt:"Image Title",className:"w-full h-48 object-cover rounded mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-700",children:t||"Chưa c\xf3 ti\xeau đề"}),(0,a.jsx)("div",{className:"mt-2 text-gray-600",children:u(n,300)}),(0,a.jsx)("p",{className:"text-gray-500 mt-4 text-sm",children:"Bao gồm một h\xecnh ảnh chất lượng cao trong c\xe2u chuyện của bạn để l\xe0m cho n\xf3 hấp dẫn hơn với người đọc."})]})]}),(0,a.jsxs)("div",{className:"w-full md:w-1/2 p-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Th\xeam Categories v\xe0 Tags"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block mb-1 font-semibold text-gray-700 flex items-center",children:[(0,a.jsx)(o.MDs,{className:"mr-2"}),"Categories (c\xe1ch nhau bằng dấu phẩy)"]}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",placeholder:"V\xed dụ: C\xf4ng nghệ, Lối sống","aria-label":"Nhập Categories"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block mb-1 font-semibold text-gray-700 flex items-center",children:[(0,a.jsx)(o.fxx,{className:"mr-2"}),"Tags (c\xe1ch nhau bằng dấu phẩy)"]}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200",placeholder:"V\xed dụ: JavaScript, Next.js","aria-label":"Nhập Tags"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{if(!p.trim()&&!h.trim()){alert("Vui l\xf2ng nhập \xedt nhất một category hoặc tag.");return}r(p,h)},className:"flex items-center bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-400","aria-label":"Đăng Ngay",children:[(0,a.jsx)(o.l_A,{className:"mr-2"}),"Đăng Ngay"]}),(0,a.jsxs)("button",{type:"button",onClick:d,className:"flex items-center bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400","aria-label":"Hủy",children:[(0,a.jsx)(o.aHS,{className:"mr-2"}),"Hủy"]})]})]})]})]})})})},p=n(2711),m=n(3784),h=()=>{let e=(0,s.useRouter)(),{user:t,setModalOpen:n,loading:o}=(0,r.a)(),[l,c]=(0,i.useState)(""),[u,h]=(0,i.useState)(""),[g,f]=(0,i.useState)(null),[x,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{o||t||n(!0)},[o,t,n]),(0,i.useEffect)(()=>{e.asPath.includes("#submit")&&(b(!0),e.replace("/write",void 0,{shallow:!0}))},[e.asPath,e]);let v=async(a,i)=>{if(!t){n(!0);return}try{let n=await (0,m.qb)({title:l,content:u,image_title:g,author_id:t.id,author:t.name,categories:a?a.split(",").map(e=>e.trim()):[],tags:i?i.split(",").map(e=>e.trim()):[]});e.push("/p/".concat(n.data.title_name))}catch(e){console.error("Failed to create post:",e),alert("Failed to create post.")}};return o?(0,a.jsx)("div",{className:"container mx-auto p-4",children:"Loading..."}):t?(0,a.jsx)("div",{className:"flex justify-center items-start min-h-screen bg-white-7000",children:(0,a.jsxs)("div",{className:"w-full max-w p-6 bg-white",children:[(0,a.jsx)(p.Z,{title:l,setTitle:c,content:u,setContent:h,imageTitle:g,setImageTitle:f}),x&&(0,a.jsx)(d,{title:l,content:u,imageTitle:g,onPublish:v,onCancel:()=>b(!1)})]})}):null}},3784:function(e,t,n){"use strict";n.d(t,{CP:function(){return o},Ix:function(){return p},Jq:function(){return s},KY:function(){return u},Td:function(){return d},a2:function(){return c},qb:function(){return r},u_:function(){return l}});var a=n(4716),i=n(6607);let s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await i.Z.get("/posts?page=".concat(e,"&limit=").concat(t))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getPosts");return{posts:n.data,totalCount:n.total_count}},r=async e=>(await a.Z.post("/api/posts",e)).data,o=async(e,t)=>(await a.Z.put("/api/posts/".concat(e),t)).data,l=async e=>(await i.Z.get("/posts/".concat(e))).data.data,c=async e=>(await i.Z.get("/p/".concat(e))).data.data,u=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await a.Z.get("/api/following/posts?page=".concat(e,"&limit=").concat(t))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getFollowingPosts");return{posts:n.data,totalCount:n.total_count}},d=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(await i.Z.get("/categories/".concat(encodeURIComponent(e),"/posts?page=").concat(t,"&limit=").concat(n))).data;if(!a||!Array.isArray(a.data)||"number"!=typeof a.total_count)throw Error("Invalid response format for getPostsByCategory");return{posts:a.data,totalCount:a.total_count}},p=async e=>{let t=new FormData;t.append("image",e);let n=await i.Z.post("/images/upload",t,{headers:{"Content-Type":"multipart/form-data"}});return console.log("response.data.url",n.data.url),n.data.url}},3114:function(e,t,n){"use strict";n.d(t,{M:function(){return x}});var a=n(5893),i=n(7294),s=n(240),r=n(6681),o=n(6014);class l extends i.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function c({children:e,isPresent:t}){let n=(0,i.useId)(),s=(0,i.useRef)(null),r=(0,i.useRef)({width:0,height:0,top:0,left:0}),{nonce:c}=(0,i.useContext)(o._);return(0,i.useInsertionEffect)(()=>{let{width:e,height:a,top:i,left:o}=r.current;if(t||!s.current||!e||!a)return;s.current.dataset.motionPopId=n;let l=document.createElement("style");return c&&(l.nonce=c),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            top: ${i}px !important;
            left: ${o}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[t]),(0,a.jsx)(l,{isPresent:t,childRef:s,sizeRef:r,children:i.cloneElement(e,{ref:s})})}let u=({children:e,initial:t,isPresent:n,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:p})=>{let m=(0,r.h)(d),h=(0,i.useId)(),g=(0,i.useCallback)(e=>{for(let t of(m.set(e,!0),m.values()))if(!t)return;o&&o()},[m,o]),f=(0,i.useMemo)(()=>({id:h,initial:t,isPresent:n,custom:l,onExitComplete:g,register:e=>(m.set(e,!1),()=>m.delete(e))}),u?[Math.random(),g]:[n,g]);return(0,i.useMemo)(()=>{m.forEach((e,t)=>m.set(t,!1))},[n]),i.useEffect(()=>{n||m.size||!o||o()},[n]),"popLayout"===p&&(e=(0,a.jsx)(c,{isPresent:n,children:e})),(0,a.jsx)(s.O.Provider,{value:f,children:e})};function d(){return new Map}var p=n(5364),m=n(5487);let h=e=>e.key||"";function g(e){let t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}var f=n(8868);let x=({children:e,exitBeforeEnter:t,custom:n,initial:s=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:c="sync"})=>{(0,m.k)(!t,"Replace exitBeforeEnter with mode='wait'");let d=(0,i.useMemo)(()=>g(e),[e]),x=d.map(h),b=(0,i.useRef)(!0),v=(0,i.useRef)(d),y=(0,r.h)(()=>new Map),[j,w]=(0,i.useState)(d),[N,C]=(0,i.useState)(d);(0,f.L)(()=>{b.current=!1,v.current=d;for(let e=0;e<N.length;e++){let t=h(N[e]);x.includes(t)?y.delete(t):!0!==y.get(t)&&y.set(t,!1)}},[N,x.length,x.join("-")]);let k=[];if(d!==j){let e=[...d];for(let t=0;t<N.length;t++){let n=N[t],a=h(n);x.includes(a)||(e.splice(t,0,n),k.push(n))}"wait"===c&&k.length&&(e=k),C(g(e)),w(d);return}let{forceRender:A}=(0,i.useContext)(p.p);return(0,a.jsx)(a.Fragment,{children:N.map(e=>{let t=h(e),i=d===N||x.includes(t);return(0,a.jsx)(u,{isPresent:i,initial:(!b.current||!!s)&&void 0,custom:i?void 0:n,presenceAffectsLayout:l,mode:c,onExitComplete:i?void 0:()=>{if(!y.has(t))return;y.set(t,!0);let e=!0;y.forEach(t=>{t||(e=!1)}),e&&(null==A||A(),C(v.current),o&&o())},children:e},t)})})}}},function(e){e.O(0,[445,911,509,197,624,888,774,179],function(){return e(e.s=1175)}),_N_E=e.O()}]);