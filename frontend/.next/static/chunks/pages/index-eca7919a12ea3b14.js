(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(3286)}])},5434:function(t,e,n){"use strict";n.d(e,{Z:function(){return y}});var a=n(5893),s=n(7294),o=n(1664),r=n.n(o),l=n(2914),i=n(1409),c=n(8997),d=n(2072),u=n(4608),x=n(5556),m=n(7414),p=n(8070),h=n(760),g=n(7559),f=n(7636),w=n(4052),j=()=>{let[t,e]=(0,s.useState)({copied:!1,error:null});return{copyLink:async t=>{try{await navigator.clipboard.writeText(t),e({copied:!0,error:null}),setTimeout(()=>e({copied:!1,error:null}),2e3)}catch(t){console.error("Failed to copy:",t),e({copied:!1,error:"Kh\xf4ng thể sao ch\xe9p đường dẫn."})}},shareOnTwitter:(t,e)=>{let n="https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(t),"&text=").concat(encodeURIComponent(e));window.open(n,"_blank","noopener,noreferrer")},shareOnFacebook:t=>{let e="https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(t));window.open(e,"_blank","noopener,noreferrer")},shareOnLinkedIn:(t,e)=>{let n="https://www.linkedin.com/sharing/share-offsite/?url=".concat(encodeURIComponent(t),"&title=").concat(encodeURIComponent(e));window.open(n,"_blank","noopener,noreferrer")},shareStatus:t}},b=t=>{let{shareUrl:e,title:n,onClose:s}=t;console.log("shareUrl",e),console.log("title",n);let{copyLink:o,shareOnTwitter:r,shareOnFacebook:i,shareOnLinkedIn:c,shareStatus:d}=j();return(0,a.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white border rounded shadow-lg z-10 transition-transform duration-200 transform opacity-100 scale-100",children:(0,a.jsxs)("ul",{className:"py-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsxs)("button",{onClick:()=>{o(e)},className:"flex items-center w-full px-4 py-2 text-left hover:bg-gray-100 focus:outline-none",children:[(0,a.jsx)(w.C3L,{className:"mr-2"})," Copy Link"]}),d.copied&&(0,a.jsx)("span",{className:"text-green-500 text-sm px-4",children:"Đ\xe3 sao ch\xe9p!"}),d.error&&(0,a.jsx)("span",{className:"text-red-500 text-sm px-4",children:d.error})]}),(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{r(e,n),s()},className:"flex items-center w-full px-4 py-2 text-left hover:bg-gray-100 focus:outline-none",children:[(0,a.jsx)(l.fWC,{className:"mr-2 text-blue-400"})," Share on X"]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{i(e),s()},className:"flex items-center w-full px-4 py-2 text-left hover:bg-gray-100 focus:outline-none",children:[(0,a.jsx)(l.tBk,{className:"mr-2 text-blue-600"})," Share on Facebook"]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{c(e,n),s()},className:"flex items-center w-full px-4 py-2 text-left hover:bg-gray-100 focus:outline-none",children:[(0,a.jsx)(l.BUd,{className:"mr-2 text-blue-700"})," Share on LinkedIn"]})})]})})},v=n(1087),y=t=>{let{post:e}=t;if(!e)return(0,a.jsx)("div",{children:"Đang tải b\xe0i viết..."});let{clapsCount:n,loading:o,mutate:w}=(0,p.B)("post",e.id),{user:j}=(0,m.a)(),{isBookmarked:y,toggleBookmark:N,loading:C}=(0,g.Z)(e.id),[k,_]=(0,s.useState)(!1),[F,Z]=(0,s.useState)(!1),E=(0,s.useRef)(),{comments:I,totalCommentReply:S,totalCount:L,isLoading:T,isError:P,mutate:R}=(0,f.M)(e.id,!0,1,10);(0,s.useEffect)(()=>{let t=t=>{E.current&&!E.current.contains(t.target)&&Z(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);let U=async()=>{if(!j){alert("Bạn cần đăng nhập để clap.");return}try{console.log("clapPost:",e.id),await (0,h.nl)(e.id),w()}catch(t){console.error("Failed to clap:",t),w(),alert("Đ\xe3 xảy ra lỗi khi clap. Vui l\xf2ng thử lại sau.")}},Y="http://localhost:3000/p/".concat(e.title_name);return(0,a.jsx)("div",{className:"rounded-lg p-6 mb-6 bg-white transition-shadow duration-300",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsxs)("div",{className:"w-full md:w-2/3 pr-0 md:pr-4",children:[(0,a.jsx)(x.Z,{author:e.user}),(0,a.jsx)(r(),{href:"/p/".concat(e.title_name),children:(0,a.jsx)("h5",{className:"text-lg text-gray-800 hover:text-blue-600 transition-colors duration-200 line-clamp-2",children:e.title})}),(0,a.jsx)("p",{className:"text-gray-600 text-sm line-clamp-2",children:(0,a.jsx)(u.Z,{html:e.preview_content,maxLength:200})}),(0,a.jsx)(d.Z,{postId:e.id}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between mt-4 space-y-2 md:space-y-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:U,className:"flex items-center text-gray-600 hover:text-red-500 transition-colors","aria-label":"Clap for this post",children:[(0,a.jsx)(i.sOS,{className:"mr-1"})," ",n]}),(0,a.jsxs)("button",{onClick:()=>{_(t=>!t)},className:"flex items-center text-gray-600 hover:text-blue-500 transition-colors","aria-label":"View comments",children:[(0,a.jsx)(i.RcG,{className:"mr-1"})," ",S]}),(0,a.jsxs)("span",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(l.dSq,{className:"mr-1"})," ",e.views]}),(0,a.jsx)(v.Z,{timestamp:e.created_at})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:N,className:"flex items-center text-gray-600 hover:text-yellow-500 transition-colors",disabled:C,"aria-label":"Bookmark this post",children:[y?(0,a.jsx)(l.VF9,{className:"mr-1"}):(0,a.jsx)(l.mCg,{className:"mr-1"}),C&&(0,a.jsx)("span",{className:"text-sm",children:"..."})]}),(0,a.jsxs)("div",{ref:E,className:"relative",children:[(0,a.jsx)("button",{onClick:()=>{Z(t=>!t)},className:"flex items-center text-gray-600 hover:text-green-500 transition-colors","aria-label":"Share this post",children:(0,a.jsx)(l.PPi,{className:"mr-1"})}),F&&(0,a.jsx)(b,{shareUrl:Y,title:e.title,onClose:()=>Z(!1)})]})]})]}),(0,a.jsx)(c.Z,{isOpen:k,onClose:()=>{_(!1)},postId:e.id,user:j})]}),(0,a.jsx)("div",{className:"w-full md:w-1/3 mt-4 md:mt-0",children:e.image_title&&(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(r(),{href:"/p/".concat(e.title_name),children:(0,a.jsx)("img",{src:e.image_title,alt:e.title,className:"h-48 w-full object-cover rounded transform hover:scale-105 transition-transform duration-300"})})})})]})})}},8818:function(t,e,n){"use strict";var a=n(5893);n(7294);var s=n(5434),o=n(8533);e.Z=t=>{let{posts:e,isLoading:n,isError:r,setSize:l,isReachingEnd:i}=t;return e?r?(0,a.jsx)("div",{className:"text-red-500",children:"Kh\xf4ng thể tải b\xe0i viết"}):n&&0===e.length?(0,a.jsx)("div",{children:"Đang tải..."}):(0,a.jsx)(o.Z,{dataLength:e.length,next:()=>{i||n||l(t=>t+1)},hasMore:!i,loader:(0,a.jsx)("div",{className:"text-center py-4",children:"Đang tải th\xeam b\xe0i viết..."}),endMessage:(0,a.jsx)("p",{className:"text-center py-4 text-gray-500"}),children:(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:e.map(t=>(0,a.jsx)(s.Z,{post:t},t.id))})}):(0,a.jsx)("div",{children:"Đang tải b\xe0i viết..."})}},3286:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return f}});var a=n(5893),s=n(7294),o=n(7414),r=n(8818),l=n(1415),i=n(8148),c=n(1992),d=n(3784);let u=(t,e)=>{var n,a,s,o;let r=async(t,e,n)=>{try{if("ForYou"===t){let t=await (0,d.Jq)(e,n);return{posts:t.posts,totalCount:t.totalCount}}if("Following"===t){let t=await (0,d.KY)(e,n);return{posts:t.posts,totalCount:t.totalCount}}{let a=await (0,d.Td)(t,e,n);return{posts:a.posts,totalCount:a.totalCount}}}catch(e){throw console.error("Error fetching ".concat(t," posts:"),e),e}},{data:l,error:i,size:u,setSize:x}=(0,c.ZP)((n,a)=>{var s,o;return a&&(null!==(o=null===(s=a.posts)||void 0===s?void 0:s.length)&&void 0!==o?o:0)<10?null:"ForYou"===t?["ForYou",n+1,10]:"Following"===t&&e?["Following",n+1,10]:t?[t,n+1,10]:null},t=>{let[e,n,a]=t;return r(e,n,a)}),m=!l&&!i||u>0&&l&&void 0===l[u-1],p=(null==l?void 0:null===(a=l[0])||void 0===a?void 0:null===(n=a.posts)||void 0===n?void 0:n.length)===0||l&&(null===(o=l[l.length-1])||void 0===o?void 0:null===(s=o.posts)||void 0===s?void 0:s.length)<10;return{posts:l?l.map(t=>t.posts||[]).flat():[],isLoading:m,isError:i,size:u,setSize:x,isReachingEnd:p,totalCount:l&&l.length>0?l[0].totalCount:0}};var x=n(8141),m=n(2413),p=n(1163),h=n(7680),g=t=>{let{activeTab:e,toggleTab:n,user:o}=t,[r,l]=(0,s.useState)([]),[i,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(!1),x=(0,p.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let t=await (0,m.d0)();console.log("tabs",t),l(t)}catch(t){u(!0),c(!1)}finally{c(!1)}})()},[]);let g=t=>{n(t)};return i?(0,a.jsx)("div",{className:"text-center",children:"Loading tabs..."}):d?(0,a.jsx)("div",{className:"text-center text-red-500",children:"Error loading tabs."}):(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-6 pb-2 overflow-x-auto",children:[o&&(0,a.jsx)("button",{onClick:()=>{x.push("/suggestion")},className:"flex-shrink-0 text-gray-600 hover:text-gray-900",children:(0,a.jsx)(h.gyF,{size:24})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:()=>g("ForYou"),className:"text-lg pb-2 whitespace-nowrap ".concat("ForYou"===e?"border-b-2 border-gray-200 text-black":"text-gray-600"," transition-colors duration-200"),children:"For You"},"ForYou"),o&&(0,a.jsx)("button",{onClick:()=>g("Following"),className:"text-lg pb-2 whitespace-nowrap ".concat("Following"===e?"border-b-2 border-gray-200 text-black":"text-gray-600"," transition-colors duration-200"),children:"Following"},"Following"),r.map(t=>(0,a.jsx)("button",{onClick:()=>g(t.name),className:"text-lg pb-2 whitespace-nowrap ".concat(e===t.name?"border-b-2 border-gray-200 text-black":"text-gray-600"," transition-colors duration-200"),children:t.name},t.id||t.name||"tab-".concat(Math.random())))]})]})},f=()=>{let{activeTab:t,toggleTab:e}=(0,x.j)(),{user:n}=(0,o.a)(),{posts:c,totalCount:d,isLoading:m,isError:p,setSize:h,isReachingEnd:f}=u(t,n);return(0,s.useEffect)(()=>{console.log("Current Tab:",t)},[t,c,d,m,p]),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[(0,a.jsx)("aside",{className:"w-full lg:w-1/12 p-4 sticky top-4 h-fit hidden lg:block",children:(0,a.jsx)(l.Z,{})}),(0,a.jsxs)("main",{className:"w-full lg:w-8/12 p-4",children:[(0,a.jsx)(g,{activeTab:t,toggleTab:e,user:n}),(0,a.jsx)(r.Z,{posts:c,isLoading:m,isError:p,setSize:h,isReachingEnd:f})]}),(0,a.jsx)("aside",{className:"w-full lg:w-3/12 p-4 sticky top-4 h-fit hidden xl:block",children:(0,a.jsx)(i.Z,{})})]})}},3784:function(t,e,n){"use strict";n.d(e,{CP:function(){return l},Ix:function(){return x},Jq:function(){return o},KY:function(){return d},Td:function(){return u},a2:function(){return c},qb:function(){return r},u_:function(){return i}});var a=n(4716),s=n(6607);let o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await s.Z.get("/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getPosts");return{posts:n.data,totalCount:n.total_count}},r=async t=>(await a.Z.post("/api/posts",t)).data,l=async(t,e)=>(await a.Z.put("/api/posts/".concat(t),e)).data,i=async t=>(await s.Z.get("/posts/".concat(t))).data.data,c=async t=>(await s.Z.get("/p/".concat(t))).data.data,d=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=(await a.Z.get("/api/following/posts?page=".concat(t,"&limit=").concat(e))).data;if(!n||!Array.isArray(n.data)||"number"!=typeof n.total_count)throw Error("Invalid response format for getFollowingPosts");return{posts:n.data,totalCount:n.total_count}},u=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(await s.Z.get("/categories/".concat(encodeURIComponent(t),"/posts?page=").concat(e,"&limit=").concat(n))).data;if(!a||!Array.isArray(a.data)||"number"!=typeof a.total_count)throw Error("Invalid response format for getPostsByCategory");return{posts:a.data,totalCount:a.total_count}},x=async t=>{let e=new FormData;e.append("image",t);let n=await s.Z.post("/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return console.log("response.data.url",n.data.url),n.data.url}}},function(t){t.O(0,[445,237,778,617,152,866,197,889,238,607,883,472,849,888,774,179],function(){return t(t.s=5557)}),_N_E=t.O()}]);